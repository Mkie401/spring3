<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Insert title here</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
		<script type="text/javascript">
			// 檢查session
			$(document).ready(function(){
				$.ajax({
					url : "/api/member/status",
					method : "POST",
					dataType : "json"
				}).done(function(data){
					console.log(data);
					if (data.success) {
						$('#companyName').text(data.companyName);
						$('#companyTel').text(data.companyTel);
						$('#welcome').text("Hello," + data.member.name);
						
					}else{
						window.location.href = "login.html";
					}
				}).fail(function(){
					window.location.href = "login.html";
				});
				
				$('#logout').click(function(){
					$.ajax({
						url : "/api/member/logout",
						method : "GET",
						dataType : "json"
					}).always(function(){
						window.location.href = "login.html";
					});
				});
				
				const rpp = 10;
				let nowPage = 0;
				let totalPage = 0;
				
				
				function loadHotel(page, size){
						$.ajax({
							url: `/api/hotel/all?page=${page}&size=${size}`,
							method: 'GET',
							dataType: "json"
						}).done(data => {
							let tbody = $("#hotelTable tbody").empty();
							data.content.forEach(hotel => {
								tbody.append(`
										<tr>
											<td>${hotel.id}</td>
											<td>${hotel.name}</td>
											<td>${hotel.tel}</td>
											<td>${hotel.addr}</td>
										</tr>
										`);
							});
							
							nowPage = data.number;
							totalPage = data.totalPages;
							$('#page').text(`${nowPage +1}/ ${totalPage}`);
						});
				}
				// 進來時要先有資料
				loadHotel(nowPage, rpp);
				
				
				$('#prev').click(() => {
					if (nowPage > 0) loadHotel(nowPage -1, rpp)
				});
				$('#next').click(() => {
					if (nowPage + 1 < totalPage) loadHotel(nowPage + 1, rpp);
				});
				
			})
		</script>	
			<style type="text/css">
			table {border-collapse: collapse; width: 90%; margin:20px}
			th, td {border: 1px solid #000; padding: 8px; text-align:center}
			th {background-color: #f2f2f2}
		</style>
	</head>
	<body>
		<h1 id="companyName">Index Page</h1>
		<h3 id="companyTel"></h3>
		<hr>
		<div id="welcome"></div>
		<hr>
		<button id="logout">Logout</button><hr>
		<button id="prev">Prev</button>    <span id="page"></span><button id="next">Next</button>
		<hr>
		<table id="hotelTable">
			<thead>
				<tr>
					<th>ID</th>
					<th>Name</th>
					<th>Tel</th>
					<th>Address</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
		
	</body>
</html>