
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Insert title here</title>
	</head>
	<body>
		<h1>Register Page</h1>
		<hr />
		<form id="regForm">
			Account: <input id="account" required="required" />
				<span id="mesg" style="color: red"></span><br />
			Password: <input id="passwd" type="password" required="required" /><br />
			Name: <input id="name" required="required" /><br />
			<input type="submit" value="Register" /><br>
			<span id="result"></span>
		</form>	
		
		<script type="text/javascript">
			let account = document.getElementById("account");
			let passwd = document.getElementById("passwd");
			let name = document.getElementById("name");
			let mesg = document.getElementById("mesg");
			let regForm = document.getElementById("regForm");
			let result = document.getElementById("result");
			
			account.addEventListener('blur', async () =>{
				if (account.value){
					let url = "/api/member/exist?account=" + account.value;
					let res = await fetch(url);
					let isExist = await res.json();
					//console.log(json);
					mesg.textContent = isExist?"帳號已使用，請更改。":"帳號可使用。";
				}
			});
			
			regForm.addEventListener('submit', async (e) => {
				e.preventDefault();
				let data = {
					account: account.value,
					passwd: passwd.value,
					name: name.value
				};
				let url = "/api/member/register";
				let res = await fetch(url, {
					method: 'POST',
					headers: {"Content-Type":"application/json"},
					body: JSON.stringify(data)
				});
				let json = await res.json();
				result.textContent = json.success?"註冊成功":"註冊失敗";
			});
		</script>
		
		
	</body>
</html>